{"version":3,"file":"xlsx.js","names":["fs","require","JSZip","PassThrough","ZipStream","StreamBuf","utils","XmlStream","bufferToString","StylesXform","CoreXform","SharedStringsXform","RelationshipsXform","ContentTypesXform","AppXform","WorkbookXform","WorksheetXform","DrawingXform","TableXform","PivotCacheRecordsXform","PivotCacheDefinitionXform","PivotTableXform","CommentsXform","VmlNotesXform","theme1Xml","fsReadFileAsync","filename","options","Promise","resolve","reject","readFile","error","data","XLSX","constructor","workbook","exists","Error","concat","stream","createReadStream","read","close","parseRels","xform","parseStream","parseWorkbook","parseSharedStrings","reconcile","model","workbookXform","worksheetXform","drawingXform","tableXform","drawingOptions","media","mediaIndex","Object","keys","drawings","forEach","name","drawing","drawingRel","drawingRels","rels","reduce","o","rel","Id","anchors","anchor","hyperlinks","picture","rId","hyperlink","Target","tableOptions","styles","values","tables","table","sheetOptions","sharedStrings","date1904","properties","comments","vmlDrawings","worksheets","worksheet","relationships","worksheetRels","sheetNo","worksheetHash","globalRels","workbookRels","sheetDefs","_processWorksheetEntry","path","push","_processCommentEntry","_processTableEntry","_processWorksheetRelsEntry","_processMediaEntry","entry","lastDot","lastIndexOf","extension","substr","streamBuf","on","length","medium","type","buffer","toBuffer","pipe","_processDrawingEntry","_processDrawingRelsEntry","_processVmlDrawingEntry","vmlDrawing","_processThemeEntry","themes","toString","createInputStream","Symbol","asyncIterator","chunks","chunk","load","Buffer","base64","from","zip","loadAsync","files","dir","entryName","match","write","async","writableObjectMode","readableObjectMode","content","process","browser","chunkSize","i","substring","end","sheets","definedNames","views","calcProperties","appXform","appProperties","company","manager","coreXform","coreProperties","assign","addMedia","all","map","append","dataimg64","indexOf","addDrawings","relsXform","prepare","xml","toXml","addTables","tableXml","target","addPivotTables","pivotTables","pivotTable","pivotCacheRecordsXform","pivotCacheDefinitionXform","pivotTableXform","Type","RelType","PivotCacheRecords","PivotCacheDefinition","addContentTypes","addApp","addCore","addThemes","theme1","addOfficeRels","OfficeDocument","CoreProperties","ExtenderProperties","addWorkbookRels","count","Styles","Theme","SharedStrings","Worksheet","id","addSharedStrings","addStyles","addWorkbook","addWorksheets","relationshipsXform","commentsXform","vmlNotesXform","xmlStream","render","_finalize","finalize","prepareModel","creator","lastModifiedBy","created","Date","modified","useSharedStrings","undefined","useStyles","Mock","worksheetOptions","drawingsCount","commentRefs","tableCount","ZipWriter","writeFile","createWriteStream","then","catch","err","writeBuffer","module","exports"],"sources":["../../../lib/xlsx/xlsx.js"],"sourcesContent":["const fs = require('fs');\nconst JSZip = require('jszip');\nconst {PassThrough} = require('readable-stream');\nconst ZipStream = require('../utils/zip-stream');\nconst StreamBuf = require('../utils/stream-buf');\n\nconst utils = require('../utils/utils');\nconst XmlStream = require('../utils/xml-stream');\nconst {bufferToString} = require('../utils/browser-buffer-decode');\n\nconst StylesXform = require('./xform/style/styles-xform');\n\nconst CoreXform = require('./xform/core/core-xform');\nconst SharedStringsXform = require('./xform/strings/shared-strings-xform');\nconst RelationshipsXform = require('./xform/core/relationships-xform');\nconst ContentTypesXform = require('./xform/core/content-types-xform');\nconst AppXform = require('./xform/core/app-xform');\nconst WorkbookXform = require('./xform/book/workbook-xform');\nconst WorksheetXform = require('./xform/sheet/worksheet-xform');\nconst DrawingXform = require('./xform/drawing/drawing-xform');\nconst TableXform = require('./xform/table/table-xform');\nconst PivotCacheRecordsXform = require('./xform/pivot-table/pivot-cache-records-xform');\nconst PivotCacheDefinitionXform = require('./xform/pivot-table/pivot-cache-definition-xform');\nconst PivotTableXform = require('./xform/pivot-table/pivot-table-xform');\nconst CommentsXform = require('./xform/comment/comments-xform');\nconst VmlNotesXform = require('./xform/comment/vml-notes-xform');\n\nconst theme1Xml = require('./xml/theme1');\n\nfunction fsReadFileAsync(filename, options) {\n  return new Promise((resolve, reject) => {\n    fs.readFile(filename, options, (error, data) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(data);\n      }\n    });\n  });\n}\n\nclass XLSX {\n  constructor(workbook) {\n    this.workbook = workbook;\n  }\n\n  // ===============================================================================\n  // Workbook\n  // =========================================================================\n  // Read\n\n  async readFile(filename, options) {\n    if (!(await utils.fs.exists(filename))) {\n      throw new Error(`File not found: ${filename}`);\n    }\n    const stream = fs.createReadStream(filename);\n    try {\n      const workbook = await this.read(stream, options);\n      stream.close();\n      return workbook;\n    } catch (error) {\n      stream.close();\n      throw error;\n    }\n  }\n\n  parseRels(stream) {\n    const xform = new RelationshipsXform();\n    return xform.parseStream(stream);\n  }\n\n  parseWorkbook(stream) {\n    const xform = new WorkbookXform();\n    return xform.parseStream(stream);\n  }\n\n  parseSharedStrings(stream) {\n    const xform = new SharedStringsXform();\n    return xform.parseStream(stream);\n  }\n\n  reconcile(model, options) {\n    const workbookXform = new WorkbookXform();\n    const worksheetXform = new WorksheetXform(options);\n    const drawingXform = new DrawingXform();\n    const tableXform = new TableXform();\n\n    workbookXform.reconcile(model);\n\n    // reconcile drawings with their rels\n    const drawingOptions = {\n      media: model.media,\n      mediaIndex: model.mediaIndex,\n    };\n    Object.keys(model.drawings).forEach(name => {\n      const drawing = model.drawings[name];\n      const drawingRel = model.drawingRels[name];\n      if (drawingRel) {\n        drawingOptions.rels = drawingRel.reduce((o, rel) => {\n          o[rel.Id] = rel;\n          return o;\n        }, {});\n        (drawing.anchors || []).forEach(anchor => {\n          const hyperlinks = anchor.picture && anchor.picture.hyperlinks;\n          if (hyperlinks && drawingOptions.rels[hyperlinks.rId]) {\n            hyperlinks.hyperlink = drawingOptions.rels[hyperlinks.rId].Target;\n            delete hyperlinks.rId;\n          }\n        });\n        drawingXform.reconcile(drawing, drawingOptions);\n      }\n    });\n\n    // reconcile tables with the default styles\n    const tableOptions = {\n      styles: model.styles,\n    };\n    Object.values(model.tables).forEach(table => {\n      tableXform.reconcile(table, tableOptions);\n    });\n\n    const sheetOptions = {\n      styles: model.styles,\n      sharedStrings: model.sharedStrings,\n      media: model.media,\n      mediaIndex: model.mediaIndex,\n      date1904: model.properties && model.properties.date1904,\n      drawings: model.drawings,\n      comments: model.comments,\n      tables: model.tables,\n      vmlDrawings: model.vmlDrawings,\n    };\n    model.worksheets.forEach(worksheet => {\n      worksheet.relationships = model.worksheetRels[worksheet.sheetNo];\n      worksheetXform.reconcile(worksheet, sheetOptions);\n    });\n\n    // delete unnecessary parts\n    delete model.worksheetHash;\n    delete model.worksheetRels;\n    delete model.globalRels;\n    delete model.sharedStrings;\n    delete model.workbookRels;\n    delete model.sheetDefs;\n    delete model.styles;\n    delete model.mediaIndex;\n    delete model.drawings;\n    delete model.drawingRels;\n    delete model.vmlDrawings;\n  }\n\n  async _processWorksheetEntry(stream, model, sheetNo, options, path) {\n    const xform = new WorksheetXform(options);\n    const worksheet = await xform.parseStream(stream);\n    worksheet.sheetNo = sheetNo;\n    model.worksheetHash[path] = worksheet;\n    model.worksheets.push(worksheet);\n  }\n\n  async _processCommentEntry(stream, model, name) {\n    const xform = new CommentsXform();\n    const comments = await xform.parseStream(stream);\n    model.comments[`../${name}.xml`] = comments;\n  }\n\n  async _processTableEntry(stream, model, name) {\n    const xform = new TableXform();\n    const table = await xform.parseStream(stream);\n    model.tables[`../tables/${name}.xml`] = table;\n  }\n\n  async _processWorksheetRelsEntry(stream, model, sheetNo) {\n    const xform = new RelationshipsXform();\n    const relationships = await xform.parseStream(stream);\n    model.worksheetRels[sheetNo] = relationships;\n  }\n\n  async _processMediaEntry(entry, model, filename) {\n    const lastDot = filename.lastIndexOf('.');\n    // if we can't determine extension, ignore it\n    if (lastDot >= 1) {\n      const extension = filename.substr(lastDot + 1);\n      const name = filename.substr(0, lastDot);\n      await new Promise((resolve, reject) => {\n        const streamBuf = new StreamBuf();\n        streamBuf.on('finish', () => {\n          model.mediaIndex[filename] = model.media.length;\n          model.mediaIndex[name] = model.media.length;\n          const medium = {\n            type: 'image',\n            name,\n            extension,\n            buffer: streamBuf.toBuffer(),\n          };\n          model.media.push(medium);\n          resolve();\n        });\n        entry.on('error', error => {\n          reject(error);\n        });\n        entry.pipe(streamBuf);\n      });\n    }\n  }\n\n  async _processDrawingEntry(entry, model, name) {\n    const xform = new DrawingXform();\n    const drawing = await xform.parseStream(entry);\n    model.drawings[name] = drawing;\n  }\n\n  async _processDrawingRelsEntry(entry, model, name) {\n    const xform = new RelationshipsXform();\n    const relationships = await xform.parseStream(entry);\n    model.drawingRels[name] = relationships;\n  }\n\n  async _processVmlDrawingEntry(entry, model, name) {\n    const xform = new VmlNotesXform();\n    const vmlDrawing = await xform.parseStream(entry);\n    model.vmlDrawings[`../drawings/${name}.vml`] = vmlDrawing;\n  }\n\n  async _processThemeEntry(entry, model, name) {\n    await new Promise((resolve, reject) => {\n      // TODO: stream entry into buffer and store the xml in the model.themes[]\n      const stream = new StreamBuf();\n      entry.on('error', reject);\n      stream.on('error', reject);\n      stream.on('finish', () => {\n        model.themes[name] = stream.read().toString();\n        resolve();\n      });\n      entry.pipe(stream);\n    });\n  }\n\n  /**\n   * @deprecated since version 4.0. You should use `#read` instead. Please follow upgrade instruction: https://github.com/exceljs/exceljs/blob/master/UPGRADE-4.0.md\n   */\n  createInputStream() {\n    throw new Error(\n      '`XLSX#createInputStream` is deprecated. You should use `XLSX#read` instead. This method will be removed in version 5.0. Please follow upgrade instruction: https://github.com/exceljs/exceljs/blob/master/UPGRADE-4.0.md'\n    );\n  }\n\n  async read(stream, options) {\n    // TODO: Remove once node v8 is deprecated\n    // Detect and upgrade old streams\n    if (!stream[Symbol.asyncIterator] && stream.pipe) {\n      stream = stream.pipe(new PassThrough());\n    }\n    const chunks = [];\n    for await (const chunk of stream) {\n      chunks.push(chunk);\n    }\n    return this.load(Buffer.concat(chunks), options);\n  }\n\n  async load(data, options) {\n    let buffer;\n    if (options && options.base64) {\n      buffer = Buffer.from(data.toString(), 'base64');\n    } else {\n      buffer = data;\n    }\n\n    const model = {\n      worksheets: [],\n      worksheetHash: {},\n      worksheetRels: [],\n      themes: {},\n      media: [],\n      mediaIndex: {},\n      drawings: {},\n      drawingRels: {},\n      comments: {},\n      tables: {},\n      vmlDrawings: {},\n    };\n\n    const zip = await JSZip.loadAsync(buffer);\n    for (const entry of Object.values(zip.files)) {\n      /* eslint-disable no-await-in-loop */\n      if (!entry.dir) {\n        let entryName = entry.name;\n        if (entryName[0] === '/') {\n          entryName = entryName.substr(1);\n        }\n        let stream;\n        if (\n          entryName.match(/xl\\/media\\//) ||\n          // themes are not parsed as stream\n          entryName.match(/xl\\/theme\\/([a-zA-Z0-9]+)[.]xml/)\n        ) {\n          stream = new PassThrough();\n          stream.write(await entry.async('nodebuffer'));\n        } else {\n          // use object mode to avoid buffer-string convention\n          stream = new PassThrough({\n            writableObjectMode: true,\n            readableObjectMode: true,\n          });\n          let content;\n          // https://www.npmjs.com/package/process\n          if (process.browser) {\n            // running in browser, use TextDecoder if possible\n            content = bufferToString(await entry.async('nodebuffer'));\n          } else {\n            // running in node.js\n            content = await entry.async('string');\n          }\n          const chunkSize = 16 * 1024;\n          for (let i = 0; i < content.length; i += chunkSize) {\n            stream.write(content.substring(i, i + chunkSize));\n          }\n        }\n        stream.end();\n        switch (entryName) {\n          case '_rels/.rels':\n            model.globalRels = await this.parseRels(stream);\n            break;\n\n          case 'xl/workbook.xml': {\n            const workbook = await this.parseWorkbook(stream);\n            model.sheets = workbook.sheets;\n            model.definedNames = workbook.definedNames;\n            model.views = workbook.views;\n            model.properties = workbook.properties;\n            model.calcProperties = workbook.calcProperties;\n            break;\n          }\n\n          case 'xl/_rels/workbook.xml.rels':\n            model.workbookRels = await this.parseRels(stream);\n            break;\n\n          case 'xl/sharedStrings.xml':\n            model.sharedStrings = new SharedStringsXform();\n            await model.sharedStrings.parseStream(stream);\n            break;\n\n          case 'xl/styles.xml':\n            model.styles = new StylesXform();\n            await model.styles.parseStream(stream);\n            break;\n\n          case 'docProps/app.xml': {\n            const appXform = new AppXform();\n            const appProperties = await appXform.parseStream(stream);\n            model.company = appProperties.company;\n            model.manager = appProperties.manager;\n            break;\n          }\n\n          case 'docProps/core.xml': {\n            const coreXform = new CoreXform();\n            const coreProperties = await coreXform.parseStream(stream);\n            Object.assign(model, coreProperties);\n            break;\n          }\n\n          default: {\n            let match = entryName.match(/xl\\/worksheets\\/sheet(\\d+)[.]xml/);\n            if (match) {\n              await this._processWorksheetEntry(stream, model, match[1], options, entryName);\n              break;\n            }\n            match = entryName.match(/xl\\/worksheets\\/_rels\\/sheet(\\d+)[.]xml.rels/);\n            if (match) {\n              await this._processWorksheetRelsEntry(stream, model, match[1]);\n              break;\n            }\n            match = entryName.match(/xl\\/theme\\/([a-zA-Z0-9]+)[.]xml/);\n            if (match) {\n              await this._processThemeEntry(stream, model, match[1]);\n              break;\n            }\n            match = entryName.match(/xl\\/media\\/([a-zA-Z0-9]+[.][a-zA-Z0-9]{3,4})$/);\n            if (match) {\n              await this._processMediaEntry(stream, model, match[1]);\n              break;\n            }\n            match = entryName.match(/xl\\/drawings\\/([a-zA-Z0-9]+)[.]xml/);\n            if (match) {\n              await this._processDrawingEntry(stream, model, match[1]);\n              break;\n            }\n            match = entryName.match(/xl\\/(comments\\d+)[.]xml/);\n            if (match) {\n              await this._processCommentEntry(stream, model, match[1]);\n              break;\n            }\n            match = entryName.match(/xl\\/tables\\/(table\\d+)[.]xml/);\n            if (match) {\n              await this._processTableEntry(stream, model, match[1]);\n              break;\n            }\n            match = entryName.match(/xl\\/drawings\\/_rels\\/([a-zA-Z0-9]+)[.]xml[.]rels/);\n            if (match) {\n              await this._processDrawingRelsEntry(stream, model, match[1]);\n              break;\n            }\n            match = entryName.match(/xl\\/drawings\\/(vmlDrawing\\d+)[.]vml/);\n            if (match) {\n              await this._processVmlDrawingEntry(stream, model, match[1]);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    this.reconcile(model, options);\n\n    // apply model\n    this.workbook.model = model;\n    return this.workbook;\n  }\n\n  // =========================================================================\n  // Write\n\n  async addMedia(zip, model) {\n    await Promise.all(\n      model.media.map(async medium => {\n        if (medium.type === 'image') {\n          const filename = `xl/media/${medium.name}.${medium.extension}`;\n          if (medium.filename) {\n            const data = await fsReadFileAsync(medium.filename);\n            return zip.append(data, {name: filename});\n          }\n          if (medium.buffer) {\n            return zip.append(medium.buffer, {name: filename});\n          }\n          if (medium.base64) {\n            const dataimg64 = medium.base64;\n            const content = dataimg64.substring(dataimg64.indexOf(',') + 1);\n            return zip.append(content, {name: filename, base64: true});\n          }\n        }\n        throw new Error('Unsupported media');\n      })\n    );\n  }\n\n  addDrawings(zip, model) {\n    const drawingXform = new DrawingXform();\n    const relsXform = new RelationshipsXform();\n\n    model.worksheets.forEach(worksheet => {\n      const {drawing} = worksheet;\n      if (drawing) {\n        drawingXform.prepare(drawing, {});\n        let xml = drawingXform.toXml(drawing);\n        zip.append(xml, {name: `xl/drawings/${drawing.name}.xml`});\n\n        xml = relsXform.toXml(drawing.rels);\n        zip.append(xml, {name: `xl/drawings/_rels/${drawing.name}.xml.rels`});\n      }\n    });\n  }\n\n  addTables(zip, model) {\n    const tableXform = new TableXform();\n\n    model.worksheets.forEach(worksheet => {\n      const {tables} = worksheet;\n      tables.forEach(table => {\n        tableXform.prepare(table, {});\n        const tableXml = tableXform.toXml(table);\n        zip.append(tableXml, {name: `xl/tables/${table.target}`});\n      });\n    });\n  }\n\n  addPivotTables(zip, model) {\n    if (!model.pivotTables.length) return;\n\n    const pivotTable = model.pivotTables[0];\n\n    const pivotCacheRecordsXform = new PivotCacheRecordsXform();\n    const pivotCacheDefinitionXform = new PivotCacheDefinitionXform();\n    const pivotTableXform = new PivotTableXform();\n    const relsXform = new RelationshipsXform();\n\n    // pivot cache records\n    // --------------------------------------------------\n    // copy of the source data.\n    //\n    // Note: cells in the columns of the source data which are part\n    // of the \"rows\" or \"columns\" of the pivot table configuration are\n    // replaced by references to their __cache field__ identifiers.\n    // See \"pivot cache definition\" below.\n\n    let xml = pivotCacheRecordsXform.toXml(pivotTable);\n    zip.append(xml, {name: 'xl/pivotCache/pivotCacheRecords1.xml'});\n\n    // pivot cache definition\n    // --------------------------------------------------\n    // cache source (source data):\n    //    ref=\"A1:E7\" on sheet=\"Sheet1\"\n    // cache fields:\n    //    - 0: \"A\" (a1, a2, a3)\n    //    - 1: \"B\" (b1, b2)\n    //    - ...\n\n    xml = pivotCacheDefinitionXform.toXml(pivotTable);\n    zip.append(xml, {name: 'xl/pivotCache/pivotCacheDefinition1.xml'});\n\n    xml = relsXform.toXml([\n      {\n        Id: 'rId1',\n        Type: XLSX.RelType.PivotCacheRecords,\n        Target: 'pivotCacheRecords1.xml',\n      },\n    ]);\n    zip.append(xml, {name: 'xl/pivotCache/_rels/pivotCacheDefinition1.xml.rels'});\n\n    // pivot tables (on destination worksheet)\n    // --------------------------------------------------\n    // location: ref=\"A3:E15\"\n    // pivotFields\n    // rowFields and rowItems\n    // colFields and colItems\n    // dataFields\n    // pivotTableStyleInfo\n\n    xml = pivotTableXform.toXml(pivotTable);\n    zip.append(xml, {name: 'xl/pivotTables/pivotTable1.xml'});\n\n    xml = relsXform.toXml([\n      {\n        Id: 'rId1',\n        Type: XLSX.RelType.PivotCacheDefinition,\n        Target: '../pivotCache/pivotCacheDefinition1.xml',\n      },\n    ]);\n    zip.append(xml, {name: 'xl/pivotTables/_rels/pivotTable1.xml.rels'});\n  }\n\n  async addContentTypes(zip, model) {\n    const xform = new ContentTypesXform();\n    const xml = xform.toXml(model);\n    zip.append(xml, {name: '[Content_Types].xml'});\n  }\n\n  async addApp(zip, model) {\n    const xform = new AppXform();\n    const xml = xform.toXml(model);\n    zip.append(xml, {name: 'docProps/app.xml'});\n  }\n\n  async addCore(zip, model) {\n    const coreXform = new CoreXform();\n    zip.append(coreXform.toXml(model), {name: 'docProps/core.xml'});\n  }\n\n  async addThemes(zip, model) {\n    const themes = model.themes || {theme1: theme1Xml};\n    Object.keys(themes).forEach(name => {\n      const xml = themes[name];\n      const path = `xl/theme/${name}.xml`;\n      zip.append(xml, {name: path});\n    });\n  }\n\n  async addOfficeRels(zip) {\n    const xform = new RelationshipsXform();\n    const xml = xform.toXml([\n      {Id: 'rId1', Type: XLSX.RelType.OfficeDocument, Target: 'xl/workbook.xml'},\n      {Id: 'rId2', Type: XLSX.RelType.CoreProperties, Target: 'docProps/core.xml'},\n      {Id: 'rId3', Type: XLSX.RelType.ExtenderProperties, Target: 'docProps/app.xml'},\n    ]);\n    zip.append(xml, {name: '_rels/.rels'});\n  }\n\n  async addWorkbookRels(zip, model) {\n    let count = 1;\n    const relationships = [\n      {Id: `rId${count++}`, Type: XLSX.RelType.Styles, Target: 'styles.xml'},\n      {Id: `rId${count++}`, Type: XLSX.RelType.Theme, Target: 'theme/theme1.xml'},\n    ];\n    if (model.sharedStrings.count) {\n      relationships.push({\n        Id: `rId${count++}`,\n        Type: XLSX.RelType.SharedStrings,\n        Target: 'sharedStrings.xml',\n      });\n    }\n    if ((model.pivotTables || []).length) {\n      const pivotTable = model.pivotTables[0];\n      pivotTable.rId = `rId${count++}`;\n      relationships.push({\n        Id: pivotTable.rId,\n        Type: XLSX.RelType.PivotCacheDefinition,\n        Target: 'pivotCache/pivotCacheDefinition1.xml',\n      });\n    }\n    model.worksheets.forEach(worksheet => {\n      worksheet.rId = `rId${count++}`;\n      relationships.push({\n        Id: worksheet.rId,\n        Type: XLSX.RelType.Worksheet,\n        Target: `worksheets/sheet${worksheet.id}.xml`,\n      });\n    });\n    const xform = new RelationshipsXform();\n    const xml = xform.toXml(relationships);\n    zip.append(xml, {name: 'xl/_rels/workbook.xml.rels'});\n  }\n\n  async addSharedStrings(zip, model) {\n    if (model.sharedStrings && model.sharedStrings.count) {\n      zip.append(model.sharedStrings.xml, {name: 'xl/sharedStrings.xml'});\n    }\n  }\n\n  async addStyles(zip, model) {\n    const {xml} = model.styles;\n    if (xml) {\n      zip.append(xml, {name: 'xl/styles.xml'});\n    }\n  }\n\n  async addWorkbook(zip, model) {\n    const xform = new WorkbookXform();\n    zip.append(xform.toXml(model), {name: 'xl/workbook.xml'});\n  }\n\n  async addWorksheets(zip, model) {\n    // preparation phase\n    const worksheetXform = new WorksheetXform();\n    const relationshipsXform = new RelationshipsXform();\n    const commentsXform = new CommentsXform();\n    const vmlNotesXform = new VmlNotesXform();\n\n    // write sheets\n    model.worksheets.forEach(worksheet => {\n      let xmlStream = new XmlStream();\n      worksheetXform.render(xmlStream, worksheet);\n      zip.append(xmlStream.xml, {name: `xl/worksheets/sheet${worksheet.id}.xml`});\n\n      if (worksheet.rels && worksheet.rels.length) {\n        xmlStream = new XmlStream();\n        relationshipsXform.render(xmlStream, worksheet.rels);\n        zip.append(xmlStream.xml, {name: `xl/worksheets/_rels/sheet${worksheet.id}.xml.rels`});\n      }\n\n      if (worksheet.comments.length > 0) {\n        xmlStream = new XmlStream();\n        commentsXform.render(xmlStream, worksheet);\n        zip.append(xmlStream.xml, {name: `xl/comments${worksheet.id}.xml`});\n\n        xmlStream = new XmlStream();\n        vmlNotesXform.render(xmlStream, worksheet);\n        zip.append(xmlStream.xml, {name: `xl/drawings/vmlDrawing${worksheet.id}.vml`});\n      }\n    });\n  }\n\n  _finalize(zip) {\n    return new Promise((resolve, reject) => {\n      zip.on('finish', () => {\n        resolve(this);\n      });\n      zip.on('error', reject);\n      zip.finalize();\n    });\n  }\n\n  prepareModel(model, options) {\n    // ensure following properties have sane values\n    model.creator = model.creator || 'ExcelJS';\n    model.lastModifiedBy = model.lastModifiedBy || 'ExcelJS';\n    model.created = model.created || new Date();\n    model.modified = model.modified || new Date();\n\n    model.useSharedStrings = options.useSharedStrings !== undefined ? options.useSharedStrings : true;\n    model.useStyles = options.useStyles !== undefined ? options.useStyles : true;\n\n    // Manage the shared strings\n    model.sharedStrings = new SharedStringsXform();\n\n    // add a style manager to handle cell formats, fonts, etc.\n    model.styles = model.useStyles ? new StylesXform(true) : new StylesXform.Mock();\n\n    // prepare all of the things before the render\n    const workbookXform = new WorkbookXform();\n    const worksheetXform = new WorksheetXform();\n\n    workbookXform.prepare(model);\n\n    const worksheetOptions = {\n      sharedStrings: model.sharedStrings,\n      styles: model.styles,\n      date1904: model.properties.date1904,\n      drawingsCount: 0,\n      media: model.media,\n    };\n    worksheetOptions.drawings = model.drawings = [];\n    worksheetOptions.commentRefs = model.commentRefs = [];\n    let tableCount = 0;\n    model.tables = [];\n    model.worksheets.forEach(worksheet => {\n      // assign unique filenames to tables\n      worksheet.tables.forEach(table => {\n        tableCount++;\n        table.target = `table${tableCount}.xml`;\n        table.id = tableCount;\n        model.tables.push(table);\n      });\n\n      worksheetXform.prepare(worksheet, worksheetOptions);\n    });\n\n    // TODO: workbook drawing list\n  }\n\n  async write(stream, options) {\n    options = options || {};\n    const {model} = this.workbook;\n    const zip = new ZipStream.ZipWriter(options.zip);\n    zip.pipe(stream);\n\n    this.prepareModel(model, options);\n\n    // render\n    await this.addContentTypes(zip, model);\n    await this.addOfficeRels(zip, model);\n    await this.addWorkbookRels(zip, model);\n    await this.addWorksheets(zip, model);\n    await this.addSharedStrings(zip, model); // always after worksheets\n    await this.addDrawings(zip, model);\n    await this.addTables(zip, model);\n    await this.addPivotTables(zip, model);\n    await Promise.all([this.addThemes(zip, model), this.addStyles(zip, model)]);\n    await this.addMedia(zip, model);\n    await Promise.all([this.addApp(zip, model), this.addCore(zip, model)]);\n    await this.addWorkbook(zip, model);\n    return this._finalize(zip);\n  }\n\n  writeFile(filename, options) {\n    const stream = fs.createWriteStream(filename);\n\n    return new Promise((resolve, reject) => {\n      stream.on('finish', () => {\n        resolve();\n      });\n      stream.on('error', error => {\n        reject(error);\n      });\n\n      this.write(stream, options)\n        .then(() => {\n          stream.end();\n        })\n        .catch(err => {\n          reject(err);\n        });\n    });\n  }\n\n  async writeBuffer(options) {\n    const stream = new StreamBuf();\n    await this.write(stream, options);\n    return stream.read();\n  }\n}\n\nXLSX.RelType = require('./rel-type');\n\nmodule.exports = XLSX;\n"],"mappings":";;AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;AACxB,MAAMC,KAAK,GAAGD,OAAO,CAAC,OAAO,CAAC;AAC9B,MAAM;EAACE;AAAW,CAAC,GAAGF,OAAO,CAAC,iBAAiB,CAAC;AAChD,MAAMG,SAAS,GAAGH,OAAO,CAAC,qBAAqB,CAAC;AAChD,MAAMI,SAAS,GAAGJ,OAAO,CAAC,qBAAqB,CAAC;AAEhD,MAAMK,KAAK,GAAGL,OAAO,CAAC,gBAAgB,CAAC;AACvC,MAAMM,SAAS,GAAGN,OAAO,CAAC,qBAAqB,CAAC;AAChD,MAAM;EAACO;AAAc,CAAC,GAAGP,OAAO,CAAC,gCAAgC,CAAC;AAElE,MAAMQ,WAAW,GAAGR,OAAO,CAAC,4BAA4B,CAAC;AAEzD,MAAMS,SAAS,GAAGT,OAAO,CAAC,yBAAyB,CAAC;AACpD,MAAMU,kBAAkB,GAAGV,OAAO,CAAC,sCAAsC,CAAC;AAC1E,MAAMW,kBAAkB,GAAGX,OAAO,CAAC,kCAAkC,CAAC;AACtE,MAAMY,iBAAiB,GAAGZ,OAAO,CAAC,kCAAkC,CAAC;AACrE,MAAMa,QAAQ,GAAGb,OAAO,CAAC,wBAAwB,CAAC;AAClD,MAAMc,aAAa,GAAGd,OAAO,CAAC,6BAA6B,CAAC;AAC5D,MAAMe,cAAc,GAAGf,OAAO,CAAC,+BAA+B,CAAC;AAC/D,MAAMgB,YAAY,GAAGhB,OAAO,CAAC,+BAA+B,CAAC;AAC7D,MAAMiB,UAAU,GAAGjB,OAAO,CAAC,2BAA2B,CAAC;AACvD,MAAMkB,sBAAsB,GAAGlB,OAAO,CAAC,+CAA+C,CAAC;AACvF,MAAMmB,yBAAyB,GAAGnB,OAAO,CAAC,kDAAkD,CAAC;AAC7F,MAAMoB,eAAe,GAAGpB,OAAO,CAAC,uCAAuC,CAAC;AACxE,MAAMqB,aAAa,GAAGrB,OAAO,CAAC,gCAAgC,CAAC;AAC/D,MAAMsB,aAAa,GAAGtB,OAAO,CAAC,iCAAiC,CAAC;AAEhE,MAAMuB,SAAS,GAAGvB,OAAO,CAAC,cAAc,CAAC;AAEzC,SAASwB,eAAeA,CAACC,QAAQ,EAAEC,OAAO,EAAE;EAC1C,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtC9B,EAAE,CAAC+B,QAAQ,CAACL,QAAQ,EAAEC,OAAO,EAAE,CAACK,KAAK,EAAEC,IAAI,KAAK;MAC9C,IAAID,KAAK,EAAE;QACTF,MAAM,CAACE,KAAK,CAAC;MACf,CAAC,MAAM;QACLH,OAAO,CAACI,IAAI,CAAC;MACf;IACF,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ;AAEA,MAAMC,IAAI,CAAC;EACTC,WAAWA,CAACC,QAAQ,EAAE;IACpB,IAAI,CAACA,QAAQ,GAAGA,QAAQ;EAC1B;;EAEA;EACA;EACA;EACA;;EAEA,MAAML,QAAQA,CAACL,QAAQ,EAAEC,OAAO,EAAE;IAChC,IAAI,EAAE,MAAMrB,KAAK,CAACN,EAAE,CAACqC,MAAM,CAACX,QAAQ,CAAC,CAAC,EAAE;MACtC,MAAM,IAAIY,KAAK,oBAAAC,MAAA,CAAoBb,QAAQ,CAAE,CAAC;IAChD;IACA,MAAMc,MAAM,GAAGxC,EAAE,CAACyC,gBAAgB,CAACf,QAAQ,CAAC;IAC5C,IAAI;MACF,MAAMU,QAAQ,GAAG,MAAM,IAAI,CAACM,IAAI,CAACF,MAAM,EAAEb,OAAO,CAAC;MACjDa,MAAM,CAACG,KAAK,CAAC,CAAC;MACd,OAAOP,QAAQ;IACjB,CAAC,CAAC,OAAOJ,KAAK,EAAE;MACdQ,MAAM,CAACG,KAAK,CAAC,CAAC;MACd,MAAMX,KAAK;IACb;EACF;EAEAY,SAASA,CAACJ,MAAM,EAAE;IAChB,MAAMK,KAAK,GAAG,IAAIjC,kBAAkB,CAAC,CAAC;IACtC,OAAOiC,KAAK,CAACC,WAAW,CAACN,MAAM,CAAC;EAClC;EAEAO,aAAaA,CAACP,MAAM,EAAE;IACpB,MAAMK,KAAK,GAAG,IAAI9B,aAAa,CAAC,CAAC;IACjC,OAAO8B,KAAK,CAACC,WAAW,CAACN,MAAM,CAAC;EAClC;EAEAQ,kBAAkBA,CAACR,MAAM,EAAE;IACzB,MAAMK,KAAK,GAAG,IAAIlC,kBAAkB,CAAC,CAAC;IACtC,OAAOkC,KAAK,CAACC,WAAW,CAACN,MAAM,CAAC;EAClC;EAEAS,SAASA,CAACC,KAAK,EAAEvB,OAAO,EAAE;IACxB,MAAMwB,aAAa,GAAG,IAAIpC,aAAa,CAAC,CAAC;IACzC,MAAMqC,cAAc,GAAG,IAAIpC,cAAc,CAACW,OAAO,CAAC;IAClD,MAAM0B,YAAY,GAAG,IAAIpC,YAAY,CAAC,CAAC;IACvC,MAAMqC,UAAU,GAAG,IAAIpC,UAAU,CAAC,CAAC;IAEnCiC,aAAa,CAACF,SAAS,CAACC,KAAK,CAAC;;IAE9B;IACA,MAAMK,cAAc,GAAG;MACrBC,KAAK,EAAEN,KAAK,CAACM,KAAK;MAClBC,UAAU,EAAEP,KAAK,CAACO;IACpB,CAAC;IACDC,MAAM,CAACC,IAAI,CAACT,KAAK,CAACU,QAAQ,CAAC,CAACC,OAAO,CAACC,IAAI,IAAI;MAC1C,MAAMC,OAAO,GAAGb,KAAK,CAACU,QAAQ,CAACE,IAAI,CAAC;MACpC,MAAME,UAAU,GAAGd,KAAK,CAACe,WAAW,CAACH,IAAI,CAAC;MAC1C,IAAIE,UAAU,EAAE;QACdT,cAAc,CAACW,IAAI,GAAGF,UAAU,CAACG,MAAM,CAAC,CAACC,CAAC,EAAEC,GAAG,KAAK;UAClDD,CAAC,CAACC,GAAG,CAACC,EAAE,CAAC,GAAGD,GAAG;UACf,OAAOD,CAAC;QACV,CAAC,EAAE,CAAC,CAAC,CAAC;QACN,CAACL,OAAO,CAACQ,OAAO,IAAI,EAAE,EAAEV,OAAO,CAACW,MAAM,IAAI;UACxC,MAAMC,UAAU,GAAGD,MAAM,CAACE,OAAO,IAAIF,MAAM,CAACE,OAAO,CAACD,UAAU;UAC9D,IAAIA,UAAU,IAAIlB,cAAc,CAACW,IAAI,CAACO,UAAU,CAACE,GAAG,CAAC,EAAE;YACrDF,UAAU,CAACG,SAAS,GAAGrB,cAAc,CAACW,IAAI,CAACO,UAAU,CAACE,GAAG,CAAC,CAACE,MAAM;YACjE,OAAOJ,UAAU,CAACE,GAAG;UACvB;QACF,CAAC,CAAC;QACFtB,YAAY,CAACJ,SAAS,CAACc,OAAO,EAAER,cAAc,CAAC;MACjD;IACF,CAAC,CAAC;;IAEF;IACA,MAAMuB,YAAY,GAAG;MACnBC,MAAM,EAAE7B,KAAK,CAAC6B;IAChB,CAAC;IACDrB,MAAM,CAACsB,MAAM,CAAC9B,KAAK,CAAC+B,MAAM,CAAC,CAACpB,OAAO,CAACqB,KAAK,IAAI;MAC3C5B,UAAU,CAACL,SAAS,CAACiC,KAAK,EAAEJ,YAAY,CAAC;IAC3C,CAAC,CAAC;IAEF,MAAMK,YAAY,GAAG;MACnBJ,MAAM,EAAE7B,KAAK,CAAC6B,MAAM;MACpBK,aAAa,EAAElC,KAAK,CAACkC,aAAa;MAClC5B,KAAK,EAAEN,KAAK,CAACM,KAAK;MAClBC,UAAU,EAAEP,KAAK,CAACO,UAAU;MAC5B4B,QAAQ,EAAEnC,KAAK,CAACoC,UAAU,IAAIpC,KAAK,CAACoC,UAAU,CAACD,QAAQ;MACvDzB,QAAQ,EAAEV,KAAK,CAACU,QAAQ;MACxB2B,QAAQ,EAAErC,KAAK,CAACqC,QAAQ;MACxBN,MAAM,EAAE/B,KAAK,CAAC+B,MAAM;MACpBO,WAAW,EAAEtC,KAAK,CAACsC;IACrB,CAAC;IACDtC,KAAK,CAACuC,UAAU,CAAC5B,OAAO,CAAC6B,SAAS,IAAI;MACpCA,SAAS,CAACC,aAAa,GAAGzC,KAAK,CAAC0C,aAAa,CAACF,SAAS,CAACG,OAAO,CAAC;MAChEzC,cAAc,CAACH,SAAS,CAACyC,SAAS,EAAEP,YAAY,CAAC;IACnD,CAAC,CAAC;;IAEF;IACA,OAAOjC,KAAK,CAAC4C,aAAa;IAC1B,OAAO5C,KAAK,CAAC0C,aAAa;IAC1B,OAAO1C,KAAK,CAAC6C,UAAU;IACvB,OAAO7C,KAAK,CAACkC,aAAa;IAC1B,OAAOlC,KAAK,CAAC8C,YAAY;IACzB,OAAO9C,KAAK,CAAC+C,SAAS;IACtB,OAAO/C,KAAK,CAAC6B,MAAM;IACnB,OAAO7B,KAAK,CAACO,UAAU;IACvB,OAAOP,KAAK,CAACU,QAAQ;IACrB,OAAOV,KAAK,CAACe,WAAW;IACxB,OAAOf,KAAK,CAACsC,WAAW;EAC1B;EAEA,MAAMU,sBAAsBA,CAAC1D,MAAM,EAAEU,KAAK,EAAE2C,OAAO,EAAElE,OAAO,EAAEwE,IAAI,EAAE;IAClE,MAAMtD,KAAK,GAAG,IAAI7B,cAAc,CAACW,OAAO,CAAC;IACzC,MAAM+D,SAAS,GAAG,MAAM7C,KAAK,CAACC,WAAW,CAACN,MAAM,CAAC;IACjDkD,SAAS,CAACG,OAAO,GAAGA,OAAO;IAC3B3C,KAAK,CAAC4C,aAAa,CAACK,IAAI,CAAC,GAAGT,SAAS;IACrCxC,KAAK,CAACuC,UAAU,CAACW,IAAI,CAACV,SAAS,CAAC;EAClC;EAEA,MAAMW,oBAAoBA,CAAC7D,MAAM,EAAEU,KAAK,EAAEY,IAAI,EAAE;IAC9C,MAAMjB,KAAK,GAAG,IAAIvB,aAAa,CAAC,CAAC;IACjC,MAAMiE,QAAQ,GAAG,MAAM1C,KAAK,CAACC,WAAW,CAACN,MAAM,CAAC;IAChDU,KAAK,CAACqC,QAAQ,OAAAhD,MAAA,CAAOuB,IAAI,UAAO,GAAGyB,QAAQ;EAC7C;EAEA,MAAMe,kBAAkBA,CAAC9D,MAAM,EAAEU,KAAK,EAAEY,IAAI,EAAE;IAC5C,MAAMjB,KAAK,GAAG,IAAI3B,UAAU,CAAC,CAAC;IAC9B,MAAMgE,KAAK,GAAG,MAAMrC,KAAK,CAACC,WAAW,CAACN,MAAM,CAAC;IAC7CU,KAAK,CAAC+B,MAAM,cAAA1C,MAAA,CAAcuB,IAAI,UAAO,GAAGoB,KAAK;EAC/C;EAEA,MAAMqB,0BAA0BA,CAAC/D,MAAM,EAAEU,KAAK,EAAE2C,OAAO,EAAE;IACvD,MAAMhD,KAAK,GAAG,IAAIjC,kBAAkB,CAAC,CAAC;IACtC,MAAM+E,aAAa,GAAG,MAAM9C,KAAK,CAACC,WAAW,CAACN,MAAM,CAAC;IACrDU,KAAK,CAAC0C,aAAa,CAACC,OAAO,CAAC,GAAGF,aAAa;EAC9C;EAEA,MAAMa,kBAAkBA,CAACC,KAAK,EAAEvD,KAAK,EAAExB,QAAQ,EAAE;IAC/C,MAAMgF,OAAO,GAAGhF,QAAQ,CAACiF,WAAW,CAAC,GAAG,CAAC;IACzC;IACA,IAAID,OAAO,IAAI,CAAC,EAAE;MAChB,MAAME,SAAS,GAAGlF,QAAQ,CAACmF,MAAM,CAACH,OAAO,GAAG,CAAC,CAAC;MAC9C,MAAM5C,IAAI,GAAGpC,QAAQ,CAACmF,MAAM,CAAC,CAAC,EAAEH,OAAO,CAAC;MACxC,MAAM,IAAI9E,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACrC,MAAMgF,SAAS,GAAG,IAAIzG,SAAS,CAAC,CAAC;QACjCyG,SAAS,CAACC,EAAE,CAAC,QAAQ,EAAE,MAAM;UAC3B7D,KAAK,CAACO,UAAU,CAAC/B,QAAQ,CAAC,GAAGwB,KAAK,CAACM,KAAK,CAACwD,MAAM;UAC/C9D,KAAK,CAACO,UAAU,CAACK,IAAI,CAAC,GAAGZ,KAAK,CAACM,KAAK,CAACwD,MAAM;UAC3C,MAAMC,MAAM,GAAG;YACbC,IAAI,EAAE,OAAO;YACbpD,IAAI;YACJ8C,SAAS;YACTO,MAAM,EAAEL,SAAS,CAACM,QAAQ,CAAC;UAC7B,CAAC;UACDlE,KAAK,CAACM,KAAK,CAAC4C,IAAI,CAACa,MAAM,CAAC;UACxBpF,OAAO,CAAC,CAAC;QACX,CAAC,CAAC;QACF4E,KAAK,CAACM,EAAE,CAAC,OAAO,EAAE/E,KAAK,IAAI;UACzBF,MAAM,CAACE,KAAK,CAAC;QACf,CAAC,CAAC;QACFyE,KAAK,CAACY,IAAI,CAACP,SAAS,CAAC;MACvB,CAAC,CAAC;IACJ;EACF;EAEA,MAAMQ,oBAAoBA,CAACb,KAAK,EAAEvD,KAAK,EAAEY,IAAI,EAAE;IAC7C,MAAMjB,KAAK,GAAG,IAAI5B,YAAY,CAAC,CAAC;IAChC,MAAM8C,OAAO,GAAG,MAAMlB,KAAK,CAACC,WAAW,CAAC2D,KAAK,CAAC;IAC9CvD,KAAK,CAACU,QAAQ,CAACE,IAAI,CAAC,GAAGC,OAAO;EAChC;EAEA,MAAMwD,wBAAwBA,CAACd,KAAK,EAAEvD,KAAK,EAAEY,IAAI,EAAE;IACjD,MAAMjB,KAAK,GAAG,IAAIjC,kBAAkB,CAAC,CAAC;IACtC,MAAM+E,aAAa,GAAG,MAAM9C,KAAK,CAACC,WAAW,CAAC2D,KAAK,CAAC;IACpDvD,KAAK,CAACe,WAAW,CAACH,IAAI,CAAC,GAAG6B,aAAa;EACzC;EAEA,MAAM6B,uBAAuBA,CAACf,KAAK,EAAEvD,KAAK,EAAEY,IAAI,EAAE;IAChD,MAAMjB,KAAK,GAAG,IAAItB,aAAa,CAAC,CAAC;IACjC,MAAMkG,UAAU,GAAG,MAAM5E,KAAK,CAACC,WAAW,CAAC2D,KAAK,CAAC;IACjDvD,KAAK,CAACsC,WAAW,gBAAAjD,MAAA,CAAgBuB,IAAI,UAAO,GAAG2D,UAAU;EAC3D;EAEA,MAAMC,kBAAkBA,CAACjB,KAAK,EAAEvD,KAAK,EAAEY,IAAI,EAAE;IAC3C,MAAM,IAAIlC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACrC;MACA,MAAMU,MAAM,GAAG,IAAInC,SAAS,CAAC,CAAC;MAC9BoG,KAAK,CAACM,EAAE,CAAC,OAAO,EAAEjF,MAAM,CAAC;MACzBU,MAAM,CAACuE,EAAE,CAAC,OAAO,EAAEjF,MAAM,CAAC;MAC1BU,MAAM,CAACuE,EAAE,CAAC,QAAQ,EAAE,MAAM;QACxB7D,KAAK,CAACyE,MAAM,CAAC7D,IAAI,CAAC,GAAGtB,MAAM,CAACE,IAAI,CAAC,CAAC,CAACkF,QAAQ,CAAC,CAAC;QAC7C/F,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;MACF4E,KAAK,CAACY,IAAI,CAAC7E,MAAM,CAAC;IACpB,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;EACEqF,iBAAiBA,CAAA,EAAG;IAClB,MAAM,IAAIvF,KAAK,CACb,0NACF,CAAC;EACH;EAEA,MAAMI,IAAIA,CAACF,MAAM,EAAEb,OAAO,EAAE;IAC1B;IACA;IACA,IAAI,CAACa,MAAM,CAACsF,MAAM,CAACC,aAAa,CAAC,IAAIvF,MAAM,CAAC6E,IAAI,EAAE;MAChD7E,MAAM,GAAGA,MAAM,CAAC6E,IAAI,CAAC,IAAIlH,WAAW,CAAC,CAAC,CAAC;IACzC;IACA,MAAM6H,MAAM,GAAG,EAAE;IACjB,WAAW,MAAMC,KAAK,IAAIzF,MAAM,EAAE;MAChCwF,MAAM,CAAC5B,IAAI,CAAC6B,KAAK,CAAC;IACpB;IACA,OAAO,IAAI,CAACC,IAAI,CAACC,MAAM,CAAC5F,MAAM,CAACyF,MAAM,CAAC,EAAErG,OAAO,CAAC;EAClD;EAEA,MAAMuG,IAAIA,CAACjG,IAAI,EAAEN,OAAO,EAAE;IACxB,IAAIwF,MAAM;IACV,IAAIxF,OAAO,IAAIA,OAAO,CAACyG,MAAM,EAAE;MAC7BjB,MAAM,GAAGgB,MAAM,CAACE,IAAI,CAACpG,IAAI,CAAC2F,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC;IACjD,CAAC,MAAM;MACLT,MAAM,GAAGlF,IAAI;IACf;IAEA,MAAMiB,KAAK,GAAG;MACZuC,UAAU,EAAE,EAAE;MACdK,aAAa,EAAE,CAAC,CAAC;MACjBF,aAAa,EAAE,EAAE;MACjB+B,MAAM,EAAE,CAAC,CAAC;MACVnE,KAAK,EAAE,EAAE;MACTC,UAAU,EAAE,CAAC,CAAC;MACdG,QAAQ,EAAE,CAAC,CAAC;MACZK,WAAW,EAAE,CAAC,CAAC;MACfsB,QAAQ,EAAE,CAAC,CAAC;MACZN,MAAM,EAAE,CAAC,CAAC;MACVO,WAAW,EAAE,CAAC;IAChB,CAAC;IAED,MAAM8C,GAAG,GAAG,MAAMpI,KAAK,CAACqI,SAAS,CAACpB,MAAM,CAAC;IACzC,KAAK,MAAMV,KAAK,IAAI/C,MAAM,CAACsB,MAAM,CAACsD,GAAG,CAACE,KAAK,CAAC,EAAE;MAC5C;MACA,IAAI,CAAC/B,KAAK,CAACgC,GAAG,EAAE;QACd,IAAIC,SAAS,GAAGjC,KAAK,CAAC3C,IAAI;QAC1B,IAAI4E,SAAS,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;UACxBA,SAAS,GAAGA,SAAS,CAAC7B,MAAM,CAAC,CAAC,CAAC;QACjC;QACA,IAAIrE,MAAM;QACV,IACEkG,SAAS,CAACC,KAAK,CAAC,aAAa,CAAC;QAC9B;QACAD,SAAS,CAACC,KAAK,CAAC,iCAAiC,CAAC,EAClD;UACAnG,MAAM,GAAG,IAAIrC,WAAW,CAAC,CAAC;UAC1BqC,MAAM,CAACoG,KAAK,CAAC,MAAMnC,KAAK,CAACoC,KAAK,CAAC,YAAY,CAAC,CAAC;QAC/C,CAAC,MAAM;UACL;UACArG,MAAM,GAAG,IAAIrC,WAAW,CAAC;YACvB2I,kBAAkB,EAAE,IAAI;YACxBC,kBAAkB,EAAE;UACtB,CAAC,CAAC;UACF,IAAIC,OAAO;UACX;UACA,IAAIC,OAAO,CAACC,OAAO,EAAE;YACnB;YACAF,OAAO,GAAGxI,cAAc,CAAC,MAAMiG,KAAK,CAACoC,KAAK,CAAC,YAAY,CAAC,CAAC;UAC3D,CAAC,MAAM;YACL;YACAG,OAAO,GAAG,MAAMvC,KAAK,CAACoC,KAAK,CAAC,QAAQ,CAAC;UACvC;UACA,MAAMM,SAAS,GAAG,EAAE,GAAG,IAAI;UAC3B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,OAAO,CAAChC,MAAM,EAAEoC,CAAC,IAAID,SAAS,EAAE;YAClD3G,MAAM,CAACoG,KAAK,CAACI,OAAO,CAACK,SAAS,CAACD,CAAC,EAAEA,CAAC,GAAGD,SAAS,CAAC,CAAC;UACnD;QACF;QACA3G,MAAM,CAAC8G,GAAG,CAAC,CAAC;QACZ,QAAQZ,SAAS;UACf,KAAK,aAAa;YAChBxF,KAAK,CAAC6C,UAAU,GAAG,MAAM,IAAI,CAACnD,SAAS,CAACJ,MAAM,CAAC;YAC/C;UAEF,KAAK,iBAAiB;YAAE;cACtB,MAAMJ,QAAQ,GAAG,MAAM,IAAI,CAACW,aAAa,CAACP,MAAM,CAAC;cACjDU,KAAK,CAACqG,MAAM,GAAGnH,QAAQ,CAACmH,MAAM;cAC9BrG,KAAK,CAACsG,YAAY,GAAGpH,QAAQ,CAACoH,YAAY;cAC1CtG,KAAK,CAACuG,KAAK,GAAGrH,QAAQ,CAACqH,KAAK;cAC5BvG,KAAK,CAACoC,UAAU,GAAGlD,QAAQ,CAACkD,UAAU;cACtCpC,KAAK,CAACwG,cAAc,GAAGtH,QAAQ,CAACsH,cAAc;cAC9C;YACF;UAEA,KAAK,4BAA4B;YAC/BxG,KAAK,CAAC8C,YAAY,GAAG,MAAM,IAAI,CAACpD,SAAS,CAACJ,MAAM,CAAC;YACjD;UAEF,KAAK,sBAAsB;YACzBU,KAAK,CAACkC,aAAa,GAAG,IAAIzE,kBAAkB,CAAC,CAAC;YAC9C,MAAMuC,KAAK,CAACkC,aAAa,CAACtC,WAAW,CAACN,MAAM,CAAC;YAC7C;UAEF,KAAK,eAAe;YAClBU,KAAK,CAAC6B,MAAM,GAAG,IAAItE,WAAW,CAAC,CAAC;YAChC,MAAMyC,KAAK,CAAC6B,MAAM,CAACjC,WAAW,CAACN,MAAM,CAAC;YACtC;UAEF,KAAK,kBAAkB;YAAE;cACvB,MAAMmH,QAAQ,GAAG,IAAI7I,QAAQ,CAAC,CAAC;cAC/B,MAAM8I,aAAa,GAAG,MAAMD,QAAQ,CAAC7G,WAAW,CAACN,MAAM,CAAC;cACxDU,KAAK,CAAC2G,OAAO,GAAGD,aAAa,CAACC,OAAO;cACrC3G,KAAK,CAAC4G,OAAO,GAAGF,aAAa,CAACE,OAAO;cACrC;YACF;UAEA,KAAK,mBAAmB;YAAE;cACxB,MAAMC,SAAS,GAAG,IAAIrJ,SAAS,CAAC,CAAC;cACjC,MAAMsJ,cAAc,GAAG,MAAMD,SAAS,CAACjH,WAAW,CAACN,MAAM,CAAC;cAC1DkB,MAAM,CAACuG,MAAM,CAAC/G,KAAK,EAAE8G,cAAc,CAAC;cACpC;YACF;UAEA;YAAS;cACP,IAAIrB,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,kCAAkC,CAAC;cAC/D,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACzC,sBAAsB,CAAC1D,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,EAAEhH,OAAO,EAAE+G,SAAS,CAAC;gBAC9E;cACF;cACAC,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,8CAA8C,CAAC;cACvE,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACpC,0BAA0B,CAAC/D,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC9D;cACF;cACAA,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,iCAAiC,CAAC;cAC1D,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACjB,kBAAkB,CAAClF,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,CAAC;gBACtD;cACF;cACAA,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,+CAA+C,CAAC;cACxE,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACnC,kBAAkB,CAAChE,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,CAAC;gBACtD;cACF;cACAA,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,oCAAoC,CAAC;cAC7D,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACrB,oBAAoB,CAAC9E,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,CAAC;gBACxD;cACF;cACAA,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,yBAAyB,CAAC;cAClD,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACtC,oBAAoB,CAAC7D,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,CAAC;gBACxD;cACF;cACAA,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,8BAA8B,CAAC;cACvD,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACrC,kBAAkB,CAAC9D,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,CAAC;gBACtD;cACF;cACAA,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,kDAAkD,CAAC;cAC3E,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACpB,wBAAwB,CAAC/E,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC5D;cACF;cACAA,KAAK,GAAGD,SAAS,CAACC,KAAK,CAAC,qCAAqC,CAAC;cAC9D,IAAIA,KAAK,EAAE;gBACT,MAAM,IAAI,CAACnB,uBAAuB,CAAChF,MAAM,EAAEU,KAAK,EAAEyF,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC3D;cACF;YACF;QACF;MACF;IACF;IAEA,IAAI,CAAC1F,SAAS,CAACC,KAAK,EAAEvB,OAAO,CAAC;;IAE9B;IACA,IAAI,CAACS,QAAQ,CAACc,KAAK,GAAGA,KAAK;IAC3B,OAAO,IAAI,CAACd,QAAQ;EACtB;;EAEA;EACA;;EAEA,MAAM8H,QAAQA,CAAC5B,GAAG,EAAEpF,KAAK,EAAE;IACzB,MAAMtB,OAAO,CAACuI,GAAG,CACfjH,KAAK,CAACM,KAAK,CAAC4G,GAAG,CAAC,MAAMnD,MAAM,IAAI;MAC9B,IAAIA,MAAM,CAACC,IAAI,KAAK,OAAO,EAAE;QAC3B,MAAMxF,QAAQ,eAAAa,MAAA,CAAe0E,MAAM,CAACnD,IAAI,OAAAvB,MAAA,CAAI0E,MAAM,CAACL,SAAS,CAAE;QAC9D,IAAIK,MAAM,CAACvF,QAAQ,EAAE;UACnB,MAAMO,IAAI,GAAG,MAAMR,eAAe,CAACwF,MAAM,CAACvF,QAAQ,CAAC;UACnD,OAAO4G,GAAG,CAAC+B,MAAM,CAACpI,IAAI,EAAE;YAAC6B,IAAI,EAAEpC;UAAQ,CAAC,CAAC;QAC3C;QACA,IAAIuF,MAAM,CAACE,MAAM,EAAE;UACjB,OAAOmB,GAAG,CAAC+B,MAAM,CAACpD,MAAM,CAACE,MAAM,EAAE;YAACrD,IAAI,EAAEpC;UAAQ,CAAC,CAAC;QACpD;QACA,IAAIuF,MAAM,CAACmB,MAAM,EAAE;UACjB,MAAMkC,SAAS,GAAGrD,MAAM,CAACmB,MAAM;UAC/B,MAAMY,OAAO,GAAGsB,SAAS,CAACjB,SAAS,CAACiB,SAAS,CAACC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;UAC/D,OAAOjC,GAAG,CAAC+B,MAAM,CAACrB,OAAO,EAAE;YAAClF,IAAI,EAAEpC,QAAQ;YAAE0G,MAAM,EAAE;UAAI,CAAC,CAAC;QAC5D;MACF;MACA,MAAM,IAAI9F,KAAK,CAAC,mBAAmB,CAAC;IACtC,CAAC,CACH,CAAC;EACH;EAEAkI,WAAWA,CAAClC,GAAG,EAAEpF,KAAK,EAAE;IACtB,MAAMG,YAAY,GAAG,IAAIpC,YAAY,CAAC,CAAC;IACvC,MAAMwJ,SAAS,GAAG,IAAI7J,kBAAkB,CAAC,CAAC;IAE1CsC,KAAK,CAACuC,UAAU,CAAC5B,OAAO,CAAC6B,SAAS,IAAI;MACpC,MAAM;QAAC3B;MAAO,CAAC,GAAG2B,SAAS;MAC3B,IAAI3B,OAAO,EAAE;QACXV,YAAY,CAACqH,OAAO,CAAC3G,OAAO,EAAE,CAAC,CAAC,CAAC;QACjC,IAAI4G,GAAG,GAAGtH,YAAY,CAACuH,KAAK,CAAC7G,OAAO,CAAC;QACrCuE,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;UAAC7G,IAAI,iBAAAvB,MAAA,CAAiBwB,OAAO,CAACD,IAAI;QAAM,CAAC,CAAC;QAE1D6G,GAAG,GAAGF,SAAS,CAACG,KAAK,CAAC7G,OAAO,CAACG,IAAI,CAAC;QACnCoE,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;UAAC7G,IAAI,uBAAAvB,MAAA,CAAuBwB,OAAO,CAACD,IAAI;QAAW,CAAC,CAAC;MACvE;IACF,CAAC,CAAC;EACJ;EAEA+G,SAASA,CAACvC,GAAG,EAAEpF,KAAK,EAAE;IACpB,MAAMI,UAAU,GAAG,IAAIpC,UAAU,CAAC,CAAC;IAEnCgC,KAAK,CAACuC,UAAU,CAAC5B,OAAO,CAAC6B,SAAS,IAAI;MACpC,MAAM;QAACT;MAAM,CAAC,GAAGS,SAAS;MAC1BT,MAAM,CAACpB,OAAO,CAACqB,KAAK,IAAI;QACtB5B,UAAU,CAACoH,OAAO,CAACxF,KAAK,EAAE,CAAC,CAAC,CAAC;QAC7B,MAAM4F,QAAQ,GAAGxH,UAAU,CAACsH,KAAK,CAAC1F,KAAK,CAAC;QACxCoD,GAAG,CAAC+B,MAAM,CAACS,QAAQ,EAAE;UAAChH,IAAI,eAAAvB,MAAA,CAAe2C,KAAK,CAAC6F,MAAM;QAAE,CAAC,CAAC;MAC3D,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEAC,cAAcA,CAAC1C,GAAG,EAAEpF,KAAK,EAAE;IACzB,IAAI,CAACA,KAAK,CAAC+H,WAAW,CAACjE,MAAM,EAAE;IAE/B,MAAMkE,UAAU,GAAGhI,KAAK,CAAC+H,WAAW,CAAC,CAAC,CAAC;IAEvC,MAAME,sBAAsB,GAAG,IAAIhK,sBAAsB,CAAC,CAAC;IAC3D,MAAMiK,yBAAyB,GAAG,IAAIhK,yBAAyB,CAAC,CAAC;IACjE,MAAMiK,eAAe,GAAG,IAAIhK,eAAe,CAAC,CAAC;IAC7C,MAAMoJ,SAAS,GAAG,IAAI7J,kBAAkB,CAAC,CAAC;;IAE1C;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA,IAAI+J,GAAG,GAAGQ,sBAAsB,CAACP,KAAK,CAACM,UAAU,CAAC;IAClD5C,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAAsC,CAAC,CAAC;;IAE/D;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA6G,GAAG,GAAGS,yBAAyB,CAACR,KAAK,CAACM,UAAU,CAAC;IACjD5C,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAAyC,CAAC,CAAC;IAElE6G,GAAG,GAAGF,SAAS,CAACG,KAAK,CAAC,CACpB;MACEtG,EAAE,EAAE,MAAM;MACVgH,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACC,iBAAiB;MACpC3G,MAAM,EAAE;IACV,CAAC,CACF,CAAC;IACFyD,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAAoD,CAAC,CAAC;;IAE7E;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA6G,GAAG,GAAGU,eAAe,CAACT,KAAK,CAACM,UAAU,CAAC;IACvC5C,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAAgC,CAAC,CAAC;IAEzD6G,GAAG,GAAGF,SAAS,CAACG,KAAK,CAAC,CACpB;MACEtG,EAAE,EAAE,MAAM;MACVgH,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACE,oBAAoB;MACvC5G,MAAM,EAAE;IACV,CAAC,CACF,CAAC;IACFyD,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAA2C,CAAC,CAAC;EACtE;EAEA,MAAM4H,eAAeA,CAACpD,GAAG,EAAEpF,KAAK,EAAE;IAChC,MAAML,KAAK,GAAG,IAAIhC,iBAAiB,CAAC,CAAC;IACrC,MAAM8J,GAAG,GAAG9H,KAAK,CAAC+H,KAAK,CAAC1H,KAAK,CAAC;IAC9BoF,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAAqB,CAAC,CAAC;EAChD;EAEA,MAAM6H,MAAMA,CAACrD,GAAG,EAAEpF,KAAK,EAAE;IACvB,MAAML,KAAK,GAAG,IAAI/B,QAAQ,CAAC,CAAC;IAC5B,MAAM6J,GAAG,GAAG9H,KAAK,CAAC+H,KAAK,CAAC1H,KAAK,CAAC;IAC9BoF,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAAkB,CAAC,CAAC;EAC7C;EAEA,MAAM8H,OAAOA,CAACtD,GAAG,EAAEpF,KAAK,EAAE;IACxB,MAAM6G,SAAS,GAAG,IAAIrJ,SAAS,CAAC,CAAC;IACjC4H,GAAG,CAAC+B,MAAM,CAACN,SAAS,CAACa,KAAK,CAAC1H,KAAK,CAAC,EAAE;MAACY,IAAI,EAAE;IAAmB,CAAC,CAAC;EACjE;EAEA,MAAM+H,SAASA,CAACvD,GAAG,EAAEpF,KAAK,EAAE;IAC1B,MAAMyE,MAAM,GAAGzE,KAAK,CAACyE,MAAM,IAAI;MAACmE,MAAM,EAAEtK;IAAS,CAAC;IAClDkC,MAAM,CAACC,IAAI,CAACgE,MAAM,CAAC,CAAC9D,OAAO,CAACC,IAAI,IAAI;MAClC,MAAM6G,GAAG,GAAGhD,MAAM,CAAC7D,IAAI,CAAC;MACxB,MAAMqC,IAAI,eAAA5D,MAAA,CAAeuB,IAAI,SAAM;MACnCwE,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;QAAC7G,IAAI,EAAEqC;MAAI,CAAC,CAAC;IAC/B,CAAC,CAAC;EACJ;EAEA,MAAM4F,aAAaA,CAACzD,GAAG,EAAE;IACvB,MAAMzF,KAAK,GAAG,IAAIjC,kBAAkB,CAAC,CAAC;IACtC,MAAM+J,GAAG,GAAG9H,KAAK,CAAC+H,KAAK,CAAC,CACtB;MAACtG,EAAE,EAAE,MAAM;MAAEgH,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACS,cAAc;MAAEnH,MAAM,EAAE;IAAiB,CAAC,EAC1E;MAACP,EAAE,EAAE,MAAM;MAAEgH,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACU,cAAc;MAAEpH,MAAM,EAAE;IAAmB,CAAC,EAC5E;MAACP,EAAE,EAAE,MAAM;MAAEgH,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACW,kBAAkB;MAAErH,MAAM,EAAE;IAAkB,CAAC,CAChF,CAAC;IACFyD,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAAa,CAAC,CAAC;EACxC;EAEA,MAAMqI,eAAeA,CAAC7D,GAAG,EAAEpF,KAAK,EAAE;IAChC,IAAIkJ,KAAK,GAAG,CAAC;IACb,MAAMzG,aAAa,GAAG,CACpB;MAACrB,EAAE,QAAA/B,MAAA,CAAQ6J,KAAK,EAAE,CAAE;MAAEd,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACc,MAAM;MAAExH,MAAM,EAAE;IAAY,CAAC,EACtE;MAACP,EAAE,QAAA/B,MAAA,CAAQ6J,KAAK,EAAE,CAAE;MAAEd,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACe,KAAK;MAAEzH,MAAM,EAAE;IAAkB,CAAC,CAC5E;IACD,IAAI3B,KAAK,CAACkC,aAAa,CAACgH,KAAK,EAAE;MAC7BzG,aAAa,CAACS,IAAI,CAAC;QACjB9B,EAAE,QAAA/B,MAAA,CAAQ6J,KAAK,EAAE,CAAE;QACnBd,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACgB,aAAa;QAChC1H,MAAM,EAAE;MACV,CAAC,CAAC;IACJ;IACA,IAAI,CAAC3B,KAAK,CAAC+H,WAAW,IAAI,EAAE,EAAEjE,MAAM,EAAE;MACpC,MAAMkE,UAAU,GAAGhI,KAAK,CAAC+H,WAAW,CAAC,CAAC,CAAC;MACvCC,UAAU,CAACvG,GAAG,SAAApC,MAAA,CAAS6J,KAAK,EAAE,CAAE;MAChCzG,aAAa,CAACS,IAAI,CAAC;QACjB9B,EAAE,EAAE4G,UAAU,CAACvG,GAAG;QAClB2G,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACE,oBAAoB;QACvC5G,MAAM,EAAE;MACV,CAAC,CAAC;IACJ;IACA3B,KAAK,CAACuC,UAAU,CAAC5B,OAAO,CAAC6B,SAAS,IAAI;MACpCA,SAAS,CAACf,GAAG,SAAApC,MAAA,CAAS6J,KAAK,EAAE,CAAE;MAC/BzG,aAAa,CAACS,IAAI,CAAC;QACjB9B,EAAE,EAAEoB,SAAS,CAACf,GAAG;QACjB2G,IAAI,EAAEpJ,IAAI,CAACqJ,OAAO,CAACiB,SAAS;QAC5B3H,MAAM,qBAAAtC,MAAA,CAAqBmD,SAAS,CAAC+G,EAAE;MACzC,CAAC,CAAC;IACJ,CAAC,CAAC;IACF,MAAM5J,KAAK,GAAG,IAAIjC,kBAAkB,CAAC,CAAC;IACtC,MAAM+J,GAAG,GAAG9H,KAAK,CAAC+H,KAAK,CAACjF,aAAa,CAAC;IACtC2C,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;MAAC7G,IAAI,EAAE;IAA4B,CAAC,CAAC;EACvD;EAEA,MAAM4I,gBAAgBA,CAACpE,GAAG,EAAEpF,KAAK,EAAE;IACjC,IAAIA,KAAK,CAACkC,aAAa,IAAIlC,KAAK,CAACkC,aAAa,CAACgH,KAAK,EAAE;MACpD9D,GAAG,CAAC+B,MAAM,CAACnH,KAAK,CAACkC,aAAa,CAACuF,GAAG,EAAE;QAAC7G,IAAI,EAAE;MAAsB,CAAC,CAAC;IACrE;EACF;EAEA,MAAM6I,SAASA,CAACrE,GAAG,EAAEpF,KAAK,EAAE;IAC1B,MAAM;MAACyH;IAAG,CAAC,GAAGzH,KAAK,CAAC6B,MAAM;IAC1B,IAAI4F,GAAG,EAAE;MACPrC,GAAG,CAAC+B,MAAM,CAACM,GAAG,EAAE;QAAC7G,IAAI,EAAE;MAAe,CAAC,CAAC;IAC1C;EACF;EAEA,MAAM8I,WAAWA,CAACtE,GAAG,EAAEpF,KAAK,EAAE;IAC5B,MAAML,KAAK,GAAG,IAAI9B,aAAa,CAAC,CAAC;IACjCuH,GAAG,CAAC+B,MAAM,CAACxH,KAAK,CAAC+H,KAAK,CAAC1H,KAAK,CAAC,EAAE;MAACY,IAAI,EAAE;IAAiB,CAAC,CAAC;EAC3D;EAEA,MAAM+I,aAAaA,CAACvE,GAAG,EAAEpF,KAAK,EAAE;IAC9B;IACA,MAAME,cAAc,GAAG,IAAIpC,cAAc,CAAC,CAAC;IAC3C,MAAM8L,kBAAkB,GAAG,IAAIlM,kBAAkB,CAAC,CAAC;IACnD,MAAMmM,aAAa,GAAG,IAAIzL,aAAa,CAAC,CAAC;IACzC,MAAM0L,aAAa,GAAG,IAAIzL,aAAa,CAAC,CAAC;;IAEzC;IACA2B,KAAK,CAACuC,UAAU,CAAC5B,OAAO,CAAC6B,SAAS,IAAI;MACpC,IAAIuH,SAAS,GAAG,IAAI1M,SAAS,CAAC,CAAC;MAC/B6C,cAAc,CAAC8J,MAAM,CAACD,SAAS,EAAEvH,SAAS,CAAC;MAC3C4C,GAAG,CAAC+B,MAAM,CAAC4C,SAAS,CAACtC,GAAG,EAAE;QAAC7G,IAAI,wBAAAvB,MAAA,CAAwBmD,SAAS,CAAC+G,EAAE;MAAM,CAAC,CAAC;MAE3E,IAAI/G,SAAS,CAACxB,IAAI,IAAIwB,SAAS,CAACxB,IAAI,CAAC8C,MAAM,EAAE;QAC3CiG,SAAS,GAAG,IAAI1M,SAAS,CAAC,CAAC;QAC3BuM,kBAAkB,CAACI,MAAM,CAACD,SAAS,EAAEvH,SAAS,CAACxB,IAAI,CAAC;QACpDoE,GAAG,CAAC+B,MAAM,CAAC4C,SAAS,CAACtC,GAAG,EAAE;UAAC7G,IAAI,8BAAAvB,MAAA,CAA8BmD,SAAS,CAAC+G,EAAE;QAAW,CAAC,CAAC;MACxF;MAEA,IAAI/G,SAAS,CAACH,QAAQ,CAACyB,MAAM,GAAG,CAAC,EAAE;QACjCiG,SAAS,GAAG,IAAI1M,SAAS,CAAC,CAAC;QAC3BwM,aAAa,CAACG,MAAM,CAACD,SAAS,EAAEvH,SAAS,CAAC;QAC1C4C,GAAG,CAAC+B,MAAM,CAAC4C,SAAS,CAACtC,GAAG,EAAE;UAAC7G,IAAI,gBAAAvB,MAAA,CAAgBmD,SAAS,CAAC+G,EAAE;QAAM,CAAC,CAAC;QAEnEQ,SAAS,GAAG,IAAI1M,SAAS,CAAC,CAAC;QAC3ByM,aAAa,CAACE,MAAM,CAACD,SAAS,EAAEvH,SAAS,CAAC;QAC1C4C,GAAG,CAAC+B,MAAM,CAAC4C,SAAS,CAACtC,GAAG,EAAE;UAAC7G,IAAI,2BAAAvB,MAAA,CAA2BmD,SAAS,CAAC+G,EAAE;QAAM,CAAC,CAAC;MAChF;IACF,CAAC,CAAC;EACJ;EAEAU,SAASA,CAAC7E,GAAG,EAAE;IACb,OAAO,IAAI1G,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACtCwG,GAAG,CAACvB,EAAE,CAAC,QAAQ,EAAE,MAAM;QACrBlF,OAAO,CAAC,IAAI,CAAC;MACf,CAAC,CAAC;MACFyG,GAAG,CAACvB,EAAE,CAAC,OAAO,EAAEjF,MAAM,CAAC;MACvBwG,GAAG,CAAC8E,QAAQ,CAAC,CAAC;IAChB,CAAC,CAAC;EACJ;EAEAC,YAAYA,CAACnK,KAAK,EAAEvB,OAAO,EAAE;IAC3B;IACAuB,KAAK,CAACoK,OAAO,GAAGpK,KAAK,CAACoK,OAAO,IAAI,SAAS;IAC1CpK,KAAK,CAACqK,cAAc,GAAGrK,KAAK,CAACqK,cAAc,IAAI,SAAS;IACxDrK,KAAK,CAACsK,OAAO,GAAGtK,KAAK,CAACsK,OAAO,IAAI,IAAIC,IAAI,CAAC,CAAC;IAC3CvK,KAAK,CAACwK,QAAQ,GAAGxK,KAAK,CAACwK,QAAQ,IAAI,IAAID,IAAI,CAAC,CAAC;IAE7CvK,KAAK,CAACyK,gBAAgB,GAAGhM,OAAO,CAACgM,gBAAgB,KAAKC,SAAS,GAAGjM,OAAO,CAACgM,gBAAgB,GAAG,IAAI;IACjGzK,KAAK,CAAC2K,SAAS,GAAGlM,OAAO,CAACkM,SAAS,KAAKD,SAAS,GAAGjM,OAAO,CAACkM,SAAS,GAAG,IAAI;;IAE5E;IACA3K,KAAK,CAACkC,aAAa,GAAG,IAAIzE,kBAAkB,CAAC,CAAC;;IAE9C;IACAuC,KAAK,CAAC6B,MAAM,GAAG7B,KAAK,CAAC2K,SAAS,GAAG,IAAIpN,WAAW,CAAC,IAAI,CAAC,GAAG,IAAIA,WAAW,CAACqN,IAAI,CAAC,CAAC;;IAE/E;IACA,MAAM3K,aAAa,GAAG,IAAIpC,aAAa,CAAC,CAAC;IACzC,MAAMqC,cAAc,GAAG,IAAIpC,cAAc,CAAC,CAAC;IAE3CmC,aAAa,CAACuH,OAAO,CAACxH,KAAK,CAAC;IAE5B,MAAM6K,gBAAgB,GAAG;MACvB3I,aAAa,EAAElC,KAAK,CAACkC,aAAa;MAClCL,MAAM,EAAE7B,KAAK,CAAC6B,MAAM;MACpBM,QAAQ,EAAEnC,KAAK,CAACoC,UAAU,CAACD,QAAQ;MACnC2I,aAAa,EAAE,CAAC;MAChBxK,KAAK,EAAEN,KAAK,CAACM;IACf,CAAC;IACDuK,gBAAgB,CAACnK,QAAQ,GAAGV,KAAK,CAACU,QAAQ,GAAG,EAAE;IAC/CmK,gBAAgB,CAACE,WAAW,GAAG/K,KAAK,CAAC+K,WAAW,GAAG,EAAE;IACrD,IAAIC,UAAU,GAAG,CAAC;IAClBhL,KAAK,CAAC+B,MAAM,GAAG,EAAE;IACjB/B,KAAK,CAACuC,UAAU,CAAC5B,OAAO,CAAC6B,SAAS,IAAI;MACpC;MACAA,SAAS,CAACT,MAAM,CAACpB,OAAO,CAACqB,KAAK,IAAI;QAChCgJ,UAAU,EAAE;QACZhJ,KAAK,CAAC6F,MAAM,WAAAxI,MAAA,CAAW2L,UAAU,SAAM;QACvChJ,KAAK,CAACuH,EAAE,GAAGyB,UAAU;QACrBhL,KAAK,CAAC+B,MAAM,CAACmB,IAAI,CAAClB,KAAK,CAAC;MAC1B,CAAC,CAAC;MAEF9B,cAAc,CAACsH,OAAO,CAAChF,SAAS,EAAEqI,gBAAgB,CAAC;IACrD,CAAC,CAAC;;IAEF;EACF;EAEA,MAAMnF,KAAKA,CAACpG,MAAM,EAAEb,OAAO,EAAE;IAC3BA,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;IACvB,MAAM;MAACuB;IAAK,CAAC,GAAG,IAAI,CAACd,QAAQ;IAC7B,MAAMkG,GAAG,GAAG,IAAIlI,SAAS,CAAC+N,SAAS,CAACxM,OAAO,CAAC2G,GAAG,CAAC;IAChDA,GAAG,CAACjB,IAAI,CAAC7E,MAAM,CAAC;IAEhB,IAAI,CAAC6K,YAAY,CAACnK,KAAK,EAAEvB,OAAO,CAAC;;IAEjC;IACA,MAAM,IAAI,CAAC+J,eAAe,CAACpD,GAAG,EAAEpF,KAAK,CAAC;IACtC,MAAM,IAAI,CAAC6I,aAAa,CAACzD,GAAG,EAAEpF,KAAK,CAAC;IACpC,MAAM,IAAI,CAACiJ,eAAe,CAAC7D,GAAG,EAAEpF,KAAK,CAAC;IACtC,MAAM,IAAI,CAAC2J,aAAa,CAACvE,GAAG,EAAEpF,KAAK,CAAC;IACpC,MAAM,IAAI,CAACwJ,gBAAgB,CAACpE,GAAG,EAAEpF,KAAK,CAAC,CAAC,CAAC;IACzC,MAAM,IAAI,CAACsH,WAAW,CAAClC,GAAG,EAAEpF,KAAK,CAAC;IAClC,MAAM,IAAI,CAAC2H,SAAS,CAACvC,GAAG,EAAEpF,KAAK,CAAC;IAChC,MAAM,IAAI,CAAC8H,cAAc,CAAC1C,GAAG,EAAEpF,KAAK,CAAC;IACrC,MAAMtB,OAAO,CAACuI,GAAG,CAAC,CAAC,IAAI,CAAC0B,SAAS,CAACvD,GAAG,EAAEpF,KAAK,CAAC,EAAE,IAAI,CAACyJ,SAAS,CAACrE,GAAG,EAAEpF,KAAK,CAAC,CAAC,CAAC;IAC3E,MAAM,IAAI,CAACgH,QAAQ,CAAC5B,GAAG,EAAEpF,KAAK,CAAC;IAC/B,MAAMtB,OAAO,CAACuI,GAAG,CAAC,CAAC,IAAI,CAACwB,MAAM,CAACrD,GAAG,EAAEpF,KAAK,CAAC,EAAE,IAAI,CAAC0I,OAAO,CAACtD,GAAG,EAAEpF,KAAK,CAAC,CAAC,CAAC;IACtE,MAAM,IAAI,CAAC0J,WAAW,CAACtE,GAAG,EAAEpF,KAAK,CAAC;IAClC,OAAO,IAAI,CAACiK,SAAS,CAAC7E,GAAG,CAAC;EAC5B;EAEA8F,SAASA,CAAC1M,QAAQ,EAAEC,OAAO,EAAE;IAC3B,MAAMa,MAAM,GAAGxC,EAAE,CAACqO,iBAAiB,CAAC3M,QAAQ,CAAC;IAE7C,OAAO,IAAIE,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACtCU,MAAM,CAACuE,EAAE,CAAC,QAAQ,EAAE,MAAM;QACxBlF,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;MACFW,MAAM,CAACuE,EAAE,CAAC,OAAO,EAAE/E,KAAK,IAAI;QAC1BF,MAAM,CAACE,KAAK,CAAC;MACf,CAAC,CAAC;MAEF,IAAI,CAAC4G,KAAK,CAACpG,MAAM,EAAEb,OAAO,CAAC,CACxB2M,IAAI,CAAC,MAAM;QACV9L,MAAM,CAAC8G,GAAG,CAAC,CAAC;MACd,CAAC,CAAC,CACDiF,KAAK,CAACC,GAAG,IAAI;QACZ1M,MAAM,CAAC0M,GAAG,CAAC;MACb,CAAC,CAAC;IACN,CAAC,CAAC;EACJ;EAEA,MAAMC,WAAWA,CAAC9M,OAAO,EAAE;IACzB,MAAMa,MAAM,GAAG,IAAInC,SAAS,CAAC,CAAC;IAC9B,MAAM,IAAI,CAACuI,KAAK,CAACpG,MAAM,EAAEb,OAAO,CAAC;IACjC,OAAOa,MAAM,CAACE,IAAI,CAAC,CAAC;EACtB;AACF;AAEAR,IAAI,CAACqJ,OAAO,GAAGtL,OAAO,CAAC,YAAY,CAAC;AAEpCyO,MAAM,CAACC,OAAO,GAAGzM,IAAI","ignoreList":[]}